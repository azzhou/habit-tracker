{% extends "layout.html" %}
{% block content %}
  <div class="content-section">

    <!-- Habit Checklist -->
    <h4 class="mb-4">Checklist</h4>
    <div class="mb-5">
      {% if habits|length > 0 %}
        <div class="table-responsive container-border mb-2">
          <table class="table">
            <thead>
              <th scope="col"></th>  <!-- Placeholder for blank upper left cell -->
              {% for date in checklist.date_labels %}
                <th scope="col" class="date-label">{{ date }}</th>
              {% endfor %}
            </thead>
            <tbody>
              {% for habit in habits %}
                <tr>
                  <th scope="row" class="habit-label">
                    <a href="{{ url_for('habits.habit', slug=habit.slug) }}"
                      class="stretched-link habit-link">
                      {{ habit.name }}
                    </a>
                  </th>
                  {% for i in range(checklist.date_labels|length) %}
                    <td>
                      <form action="{{ checklist.routes[habit.id][i] }}", method="POST">
                        <label class="checkmark-container">
                          <input type="checkbox"
                                oninput="submit()"
                                {{ 'checked' if checklist.default_values[habit.id][i] else '' }}>
                          <span class="checkmark"></span>
                        </label>
                      </form>
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
      
      <form method="POST" action="">
        {{ new_habit_form.hidden_tag() }}
        {% if new_habit_form.name.errors %}
          {{ new_habit_form.name(class="form-control is-invalid", placeholder="Add New Habit") }}
          <div class="invalid-feedback">
            {% for error in new_habit_form.name.errors %}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% else %}
          {{ new_habit_form.name(class="form-control", placeholder="Add New Habit") }}
        {% endif %}
      </form>
    </div>

    <!-- Habit 1-yr history grid -->
    <h4 class="mb-4">History</h4>
    <div class="graph-container container-border mb-5">
      <div class="graph">
        <ul class="months">
          {% for month in history_grid.month_labels %}
            <li>{{ month }}</li>
          {% endfor %}
        </ul>
        <ul class="days">
          <li>Sun</li>
          <li>Mon</li>
          <li>Tue</li>
          <li>Wed</li>
          <li>Thu</li>
          <li>Fri</li>
          <li>Sat</li>
        </ul>
        <ul class="squares">
          {% for grid_square in history_grid.squares %}
            <li data-level="{{ grid_square.level }}">
              <div class="grid-tooltip">
                <div class="font-weight-bold">
                  {{ grid_square.num_complete }} / {{ grid_square.num_active }} completed
                </div>
                <div>on {{ grid_square.date_label }}</div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

  </div>
{% endblock content %}